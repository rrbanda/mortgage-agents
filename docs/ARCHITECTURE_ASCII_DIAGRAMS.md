# Mortgage Agent System - ASCII Architecture Diagrams

**Refactored Architecture Overview**  
Last Updated: 2025-10-06

---

## ğŸ“‹ Table of Contents

1. [System Architecture Overview](#1-system-architecture-overview)
2. [Agent Tool Breakdown](#2-agent-tool-breakdown)
3. [Data Access Patterns](#3-data-access-patterns)
4. [Example: How An Agent Uses Both Tool Types](#4-example-how-an-agent-uses-both-tool-types)
5. [Request Flow](#5-request-flow)
6. [Code Structure](#6-code-structure)
7. [Key Statistics](#7-key-statistics)
8. [Key Principles](#8-key-principles)

---

## 1ï¸âƒ£ SYSTEM ARCHITECTURE OVERVIEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ‘¤ USER / CUSTOMER                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ¯ INTELLIGENT ROUTER (LLM-Powered)                    â”‚
â”‚                  Classifies and routes to specialist agent               â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚          â”‚          â”‚          â”‚
    â–¼         â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“    â”‚ â”‚   ğŸ’¼    â”‚ â”‚   ğŸ“„    â”‚ â”‚   ğŸ     â”‚ â”‚   ğŸ”    â”‚
â”‚  APP    â”‚ â”‚ ADVISOR â”‚ â”‚   DOC   â”‚ â”‚APPRAISALâ”‚ â”‚UNDERWRITâ”‚
â”‚ AGENT   â”‚ â”‚  AGENT  â”‚ â”‚  AGENT  â”‚ â”‚  AGENT  â”‚ â”‚  AGENT  â”‚
â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚
â”‚ 5+2=7   â”‚ â”‚ 3+3=6   â”‚ â”‚ 5+1=6   â”‚ â”‚ 5+1=6   â”‚ â”‚ 8+3=11  â”‚
â”‚ tools   â”‚ â”‚ tools   â”‚ â”‚ tools   â”‚ â”‚ tools   â”‚ â”‚ tools   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚           â”‚           â”‚
     â”‚           â”‚           â”‚           â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ğŸ“š SHARED BUSINESS RULES          â”‚
            â”‚  app/agents/shared/rules/          â”‚
            â”‚                                    â”‚
            â”‚  â€¢ get_application_intake_rules    â”‚
            â”‚  â€¢ get_loan_program_requirements   â”‚
            â”‚  â€¢ get_document_requirements       â”‚
            â”‚  â€¢ get_qualification_criteria      â”‚
            â”‚  â€¢ get_underwriting_rules          â”‚
            â”‚  â€¢ get_aus_rules                   â”‚
            â”‚  â€¢ get_income_calculation_rules    â”‚
            â”‚  â€¢ get_property_appraisal_rules    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ğŸ”Œ MCP SERVER                     â”‚
            â”‚  Model Context Protocol            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ğŸ—„ï¸  NEO4J GRAPH DATABASE         â”‚
            â”‚  Business Rules Storage            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY:
â”â”â” Operational Tools â†’ Direct Neo4j Access (fast)
â”€â”€â”€ Business Rules Tools â†’ Via MCP (consistent)
```

---

## 2ï¸âƒ£ AGENT TOOL BREAKDOWN

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     5 SPECIALIZED AGENTS                           â•‘
â•‘                     26 Operational + 10 Business Rules = 36 Tools  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ APPLICATION AGENT (7 tools: 5 operational + 2 business rules)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERATIONAL (5):                                                   â”‚
â”‚  âœ“ receive_mortgage_application     - Collect application data    â”‚
â”‚  âœ“ retrieve_stored_application      - Get saved applications      â”‚
â”‚  âœ“ check_application_completeness   - Verify data completeness    â”‚
â”‚  âœ“ perform_initial_qualification    - Calculate DTI/LTV           â”‚
â”‚  âœ“ generate_urla_form                - Generate Form 1003         â”‚
â”‚                                                                    â”‚
â”‚ BUSINESS RULES (2):                                                â”‚
â”‚  ğŸ”´ get_application_intake_rules     - Required fields            â”‚
â”‚  ğŸ”´ get_loan_program_requirements    - Program requirements       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¼ MORTGAGE ADVISOR AGENT (6 tools: 3 operational + 3 business)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERATIONAL (3):                                                   â”‚
â”‚  âœ“ explain_loan_programs             - Explain loan types         â”‚
â”‚  âœ“ recommend_loan_program            - Suggest programs           â”‚
â”‚  âœ“ check_qualification_requirements  - Check data completeness    â”‚
â”‚                                                                    â”‚
â”‚ BUSINESS RULES (3):                                                â”‚
â”‚  ğŸ”´ get_loan_program_requirements    - Program requirements       â”‚
â”‚  ğŸ”´ get_qualification_criteria       - Qualification thresholds   â”‚
â”‚  ğŸ”´ get_underwriting_rules           - Credit/DTI/LTV limits      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ DOCUMENT AGENT (6 tools: 5 operational + 1 business rules)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERATIONAL (5):                                                   â”‚
â”‚  âœ“ process_uploaded_document         - Process documents          â”‚
â”‚  âœ“ extract_document_data             - Extract structured data    â”‚
â”‚  âœ“ get_document_status               - Check upload status        â”‚
â”‚  âœ“ verify_document_completeness      - List uploaded docs         â”‚
â”‚  âœ“ validate_urla_form                - Validate URLA structure    â”‚
â”‚                                                                    â”‚
â”‚ BUSINESS RULES (1):                                                â”‚
â”‚  ğŸ”´ get_document_requirements        - Required documents         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  APPRAISAL AGENT (6 tools: 5 operational + 1 business rules)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERATIONAL (5):                                                   â”‚
â”‚  âœ“ analyze_property_value            - Property valuation         â”‚
â”‚  âœ“ find_comparable_sales             - Research comparables       â”‚
â”‚  âœ“ assess_property_condition         - Condition assessment       â”‚
â”‚  âœ“ review_appraisal_report           - Review appraisal docs      â”‚
â”‚  âœ“ evaluate_market_conditions        - Market analysis            â”‚
â”‚                                                                    â”‚
â”‚ BUSINESS RULES (1):                                                â”‚
â”‚  ğŸ”´ get_property_appraisal_rules     - LTV limits, standards      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” UNDERWRITING AGENT (11 tools: 8 operational + 3 business)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERATIONAL (8):                                                   â”‚
â”‚  âœ“ analyze_credit_risk               - Credit risk analysis       â”‚
â”‚  âœ“ calculate_debt_to_income          - DTI calculation            â”‚
â”‚  âœ“ evaluate_income_sources           - Income evaluation          â”‚
â”‚  âœ“ run_aus_check                     - AUS integration            â”‚
â”‚  âœ“ make_underwriting_decision        - Decision analysis          â”‚
â”‚  âœ“ get_credit_score (MCP)            - Real-time credit scores    â”‚
â”‚  âœ“ verify_identity (MCP)             - Identity verification      â”‚
â”‚  âœ“ get_credit_report (MCP)           - Credit reports             â”‚
â”‚                                                                    â”‚
â”‚ BUSINESS RULES (3):                                                â”‚
â”‚  ğŸ”´ get_underwriting_rules           - Credit/DTI/LTV limits      â”‚
â”‚  ğŸ”´ get_aus_rules                    - AUS system rules            â”‚
â”‚  ğŸ”´ get_income_calculation_rules     - Income qualification       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LEGEND:
  âœ“  = Operational Tool (NO hardcoded business rules)
  ğŸ”´ = Business Rules Tool (from shared/rules/, via MCP)
```

---

## 3ï¸âƒ£ DATA ACCESS PATTERNS

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          TWO TYPES OF TOOLS = TWO DATA ACCESS PATHS          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATH 1: OPERATIONAL TOOLS (Fast, Direct Access)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Agent calls operational tool
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Operational Tool â”‚  Examples:
    â”‚                  â”‚  - calculate_debt_to_income
    â”‚ â€¢ Calculate      â”‚  - extract_document_data
    â”‚ â€¢ Process        â”‚  - analyze_property_value
    â”‚ â€¢ Extract        â”‚
    â”‚ â€¢ Display        â”‚  NO hardcoded business rules
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Just operations & calculations
             â”‚
             â”‚ Direct Cypher Queries
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   NEO4J DB      â”‚
    â”‚  (Direct)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATH 2: BUSINESS RULES TOOLS (Consistent, Via MCP)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Agent calls business rules tool
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Business Rules Tool  â”‚  Examples:
    â”‚                      â”‚  - get_underwriting_rules
    â”‚ From shared/rules/   â”‚  - get_loan_program_requirements
    â”‚                      â”‚  - get_qualification_criteria
    â”‚ â€¢ Query rules        â”‚
    â”‚ â€¢ Get thresholds     â”‚  Returns actual requirements
    â”‚ â€¢ Fetch requirements â”‚  (credit scores, DTI limits, etc)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Via MCP Protocol
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    MCP SERVER        â”‚
    â”‚                      â”‚
    â”‚ - Standardized API   â”‚
    â”‚ - Consistent format  â”‚
    â”‚ - Rule validation    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Cypher Queries
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   NEO4J DB           â”‚
    â”‚  (Via MCP)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ EXAMPLE: HOW AN AGENT USES BOTH TOOL TYPES

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  EXAMPLE: MortgageAdvisorAgent answering "Can I get FHA?"     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User: "I have 600 credit score, make $5k/month, $500 debts.
       Can I qualify for FHA loan?"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MortgageAdvisorAgent decides which tools to use             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                  â”‚                                â”‚
       â–¼                  â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPERATIONAL â”‚  â”‚ OPERATIONAL      â”‚  â”‚ BUSINESS RULES      â”‚
â”‚ TOOL        â”‚  â”‚ TOOL             â”‚  â”‚ TOOL                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚               â”‚                  â”‚
â”‚ calculate_   â”‚  â”‚ recommend_      â”‚  â”‚ get_loan_program_   â”‚
â”‚ debt_to_     â”‚  â”‚ loan_program    â”‚  â”‚ requirements        â”‚
â”‚ income       â”‚  â”‚                 â”‚  â”‚                     â”‚
â”‚               â”‚                  â”‚
â”‚ Input:       â”‚  â”‚ Input:          â”‚  â”‚ Input:              â”‚
â”‚ â€¢ $5k income â”‚  â”‚ â€¢ Credit: 600   â”‚  â”‚ â€¢ Program: "FHA"    â”‚
â”‚ â€¢ $500 debts â”‚  â”‚ â€¢ DTI: 10%      â”‚  â”‚                     â”‚
â”‚               â”‚  â”‚ â€¢ Down: $10k    â”‚  â”‚                     â”‚
â”‚ Output:      â”‚  â”‚                 â”‚  â”‚ Output:             â”‚
â”‚ âœ“ DTI = 10%  â”‚  â”‚ Output:         â”‚  â”‚ ğŸ”´ Min Credit: 580  â”‚
â”‚              â”‚  â”‚ âœ“ "FHA might    â”‚  â”‚ ğŸ”´ Min Down: 3.5%   â”‚
â”‚ NO RULES!    â”‚  â”‚    be suitable" â”‚  â”‚ ğŸ”´ Max DTI: 43%     â”‚
â”‚ Just math    â”‚  â”‚                 â”‚  â”‚                     â”‚
â”‚              â”‚  â”‚ NO THRESHOLDS!  â”‚  â”‚ ACTUAL RULES!       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Agent combines all results:           â”‚
       â”‚                                        â”‚
       â”‚  "Your DTI is 10% (excellent!)         â”‚
       â”‚   FHA loan requirements:               â”‚
       â”‚   âœ“ Credit 580+ (you have 600 âœ“)      â”‚
       â”‚   âœ“ Down payment 3.5%                  â”‚
       â”‚   âœ“ DTI max 43% (you have 10% âœ“)      â”‚
       â”‚                                        â”‚
       â”‚    You qualify for FHA!"             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ REQUEST FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER MAKES REQUEST                          â”‚
â”‚     "I want to apply for a mortgage with 620 credit score"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   INTELLIGENT ROUTER â”‚
                  â”‚   (LLM Classification)â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
            â–¼                â–¼                â–¼
       Application?      Document?       Guidance?
            â”‚                â”‚                â”‚
            â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Application  â”‚  â”‚  Document    â”‚  â”‚  Mortgage    â”‚
    â”‚    Agent     â”‚  â”‚   Agent      â”‚  â”‚   Advisor    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚                 â”‚
           â–¼                 â–¼                 â–¼
    Uses operational    Uses operational    Uses operational
    + business rules    + business rules    + business rules
           â”‚                 â”‚                 â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   RESPONSE TO USER   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6ï¸âƒ£ CODE STRUCTURE

```
app/agents/
â”‚
â”œâ”€â”€ shared/
â”‚   â””â”€â”€ rules/                          ğŸ”´ BUSINESS RULES (Shared)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ get_application_intake_rules.py
â”‚       â”œâ”€â”€ get_loan_program_requirements.py
â”‚       â”œâ”€â”€ get_document_requirements.py
â”‚       â”œâ”€â”€ get_qualification_criteria.py
â”‚       â”œâ”€â”€ get_underwriting_rules.py
â”‚       â”œâ”€â”€ get_aus_rules.py
â”‚       â”œâ”€â”€ get_income_calculation_rules.py
â”‚       â””â”€â”€ get_property_appraisal_rules.py
â”‚
â”œâ”€â”€ application_agent/
â”‚   â”œâ”€â”€ agent.py                       âš™ï¸  Combines operational + BR
â”‚   â””â”€â”€ tools/                         âœ“  OPERATIONAL ONLY
â”‚       â”œâ”€â”€ receive_mortgage_application.py
â”‚       â”œâ”€â”€ retrieve_stored_application.py
â”‚       â”œâ”€â”€ check_application_completeness.py
â”‚       â”œâ”€â”€ perform_initial_qualification.py
â”‚       â””â”€â”€ generate_urla_form.py
â”‚
â”œâ”€â”€ mortgage_advisor_agent/
â”‚   â”œâ”€â”€ agent.py                       âš™ï¸  Combines operational + BR
â”‚   â””â”€â”€ tools/                         âœ“  OPERATIONAL ONLY
â”‚       â”œâ”€â”€ explain_loan_programs.py
â”‚       â”œâ”€â”€ recommend_loan_program.py
â”‚       â””â”€â”€ check_qualification_requirements.py
â”‚
â”œâ”€â”€ document_agent/
â”‚   â”œâ”€â”€ agent.py                       âš™ï¸  Combines operational + BR
â”‚   â””â”€â”€ tools/                         âœ“  OPERATIONAL ONLY
â”‚       â”œâ”€â”€ process_uploaded_document.py
â”‚       â”œâ”€â”€ extract_document_data.py
â”‚       â”œâ”€â”€ get_document_status.py
â”‚       â”œâ”€â”€ verify_document_completeness.py
â”‚       â””â”€â”€ validate_urla_form.py
â”‚
â”œâ”€â”€ appraisal_agent/
â”‚   â”œâ”€â”€ agent.py                       âš™ï¸  Combines operational + BR
â”‚   â””â”€â”€ tools/                         âœ“  OPERATIONAL ONLY
â”‚       â”œâ”€â”€ analyze_property_value.py
â”‚       â”œâ”€â”€ find_comparable_sales.py
â”‚       â”œâ”€â”€ assess_property_condition.py
â”‚       â”œâ”€â”€ review_appraisal_report.py
â”‚       â””â”€â”€ evaluate_market_conditions.py
â”‚
â”œâ”€â”€ underwriting_agent/
â”‚   â”œâ”€â”€ agent.py                       âš™ï¸  Combines operational + BR
â”‚   â””â”€â”€ tools/                         âœ“  OPERATIONAL ONLY
â”‚       â”œâ”€â”€ analyze_credit_risk.py
â”‚       â”œâ”€â”€ calculate_debt_to_income.py
â”‚       â”œâ”€â”€ evaluate_income_sources.py
â”‚       â”œâ”€â”€ run_aus_check.py
â”‚       â”œâ”€â”€ make_underwriting_decision.py
â”‚       â”œâ”€â”€ get_credit_score.py (MCP)
â”‚       â”œâ”€â”€ verify_identity.py (MCP)
â”‚       â””â”€â”€ get_credit_report.py (MCP)
â”‚
â””â”€â”€ mortgage_workflow.py               ğŸ¯ ROUTER (5 agents only)
```

---

## 7ï¸âƒ£ KEY STATISTICS

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SYSTEM STATISTICS                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AGENTS: 5 Total                                               â”‚
â”‚  â”œâ”€ ApplicationAgent          (7 tools)                        â”‚
â”‚  â”œâ”€ MortgageAdvisorAgent      (6 tools)                        â”‚
â”‚  â”œâ”€ DocumentAgent             (6 tools)                        â”‚
â”‚  â”œâ”€ AppraisalAgent            (6 tools)                        â”‚
â”‚  â””â”€ UnderwritingAgent         (11 tools)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TOOLS: 36 Total                                               â”‚
â”‚  â”œâ”€ Operational Tools         26 tools (72%)                   â”‚
â”‚  â””â”€ Business Rules Tools      10 tools (28%)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUSINESS RULES: 8 Unique Rule Sets (in shared/rules/)        â”‚
â”‚  â”œâ”€ get_application_intake_rules                               â”‚
â”‚  â”œâ”€ get_loan_program_requirements                              â”‚
â”‚  â”œâ”€ get_document_requirements                                  â”‚
â”‚  â”œâ”€ get_qualification_criteria                                 â”‚
â”‚  â”œâ”€ get_underwriting_rules                                     â”‚
â”‚  â”œâ”€ get_aus_rules                                              â”‚
â”‚  â”œâ”€ get_income_calculation_rules                               â”‚
â”‚  â””â”€ get_property_appraisal_rules                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8ï¸âƒ£ KEY PRINCIPLES

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               ARCHITECTURAL PRINCIPLES                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 SEPARATION OF CONCERNS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Operational Tools:   NO hardcoded business rules        â”‚
   â”‚ Business Rules Tools: From shared/rules/ via MCP        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 DATA ACCESS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Operational Tools:   Direct Neo4j access (fast)         â”‚
   â”‚ Business Rules Tools: Via MCP (consistent)              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 SCOPED BUSINESS RULES
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Each agent gets ONLY the business rules it needs        â”‚
   â”‚ Not all 8 rules - just relevant ones                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 NO SEPARATE BUSINESS RULES AGENT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agents access business rules DIRECTLY                   â”‚
   â”‚ No routing to separate agent needed                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 CENTRALIZED BUSINESS RULES
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ All business rules in: app/agents/shared/rules/         â”‚
   â”‚ Single source of truth for all agents                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Quick Summary Table

| Agent | Operational Tools | Business Rules | Total | Key Purpose |
|-------|------------------|----------------|-------|-------------|
| ApplicationAgent | 5 | 2 | 7 | Application intake & URLA |
| MortgageAdvisorAgent | 3 | 3 | 6 | Guidance & recommendations |
| DocumentAgent | 5 | 1 | 6 | Document processing |
| AppraisalAgent | 5 | 1 | 6 | Property valuation |
| UnderwritingAgent | 8 | 3 | 11 | Credit & underwriting |
| **TOTAL** | **26** | **10** | **36** | **Complete mortgage system** |

---

## ğŸ¯ Benefits of This Architecture

1. **âš¡ Faster Response Times**
   - No agent-to-agent routing
   - Direct access to business rules
   - Operational tools use direct Neo4j queries

2. **ğŸ§¹ Cleaner Code**
   - Clear separation: operational vs business rules
   - No hardcoded business logic in operational tools
   - Single source of truth for business rules

3. **ğŸ”§ Easier Maintenance**
   - Business rules in one location (`shared/rules/`)
   - Changes to rules don't affect operational code
   - Each agent only has rules it needs (scoped)

4. **ğŸ§ª Better Testing**
   - Test operational and business rules independently
   - Mock business rules easily for operational tests
   - Validate business rules separately

5. **ğŸ“ˆ Scalable**
   - Add new agents without touching business rules
   - Add new business rules without touching operational code
   - Each agent is independent and focused

---

**ğŸ‰ This architecture provides a clean, maintainable, and efficient mortgage processing system!**
